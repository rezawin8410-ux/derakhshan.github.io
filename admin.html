<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<title>پنل مدیریت – درخشان</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css">
<link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
<style>
:root{--primary:#00bfa5;--accent:#ff6f00;--bg:#f5f5f5}
body{font-family:Tahoma;background:var(--bg);margin:0}
.section{background:#fff;border-radius:10px;padding:20px;margin-bottom:25px}
h2{color:var(--primary);margin-bottom:15px}
.nav-tabs .nav-link{cursor:pointer}
</style>
</head>
<body>
<div class="container-fluid mt-3">
  <h1 class="text-center mb-4">پنل مدیریت – درخشان</h1>

  <!-- LOGIN -->
  <div id="loginBox" class="text-center" style="max-width:400px;margin:auto">
    <input type="password" id="pass" class="form-control mb-2" placeholder="رمز عبور">
    <button class="btn btn-success w-100" onclick="login()">ورود</button>
    <p id="msg" class="text-danger mt-2"></p>
  </div>

  <!-- NAV TABS -->
  <ul class="nav nav-tabs d-none" id="mainTabs" role="tablist">
    <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#tabPosts" role="tab">پست‌ها</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#tabMedia" role="tab">رسانه</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#tabSeo" role="tab">سئو</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#tabDesign" role="tab">طراحی</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#tabTeam" role="tab">تیم</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#tabSettings" role="tab">تنظیمات</a></li>
  </ul>

  <!-- TAB PANES -->
  <div class="tab-content d-none" id="tabContent">
    <!-- پست‌ها -->
    <div class="tab-pane fade show active" id="tabPosts" role="tabpanel">
      <div class="section">
        <h2>ساخت / ویرایش پست</h2>
        <input type="hidden" id="postId">
        <input id="postTitle" class="form-control mb-2" placeholder="عنوان">
        <select id="postType" class="form-select mb-2">
          <option value="standard">Standard</option>
          <option value="gallery">Gallery</option>
          <option value="video">Video</option>
          <option value="audio">Audio</option>
          <option value="quote">Quote</option>
          <option value="link">Link</option>
          <option value="trivia">Trivia</option>
          <option value="live">Live-Blog</option>
        </select>
        <div id="editorPost" class="border mb-2"></div>
        <button class="btn btn-primary" onclick="savePost()">ذخیره پست</button>
      </div>
      <div class="section">
        <h2>پست‌های موجود</h2>
        <div id="postsList"></div>
      </div>
    </div>

    <!-- رسانه -->
    <div class="tab-pane fade" id="tabMedia" role="tabpanel">
      <div class="section">
        <h2>رسانه‌ها</h2>
        <input type="file" multiple accept="image/*,video/*,audio/*" onchange="uploadMedia(event)">
        <div id="mediaList" class="row g-2 mt-2"></div>
      </div>
    </div>

    <!-- سئو -->
    <div class="tab-pane fade" id="tabSeo" role="tabpanel">
      <div class="section">
        <h2>سئو و اسکیما</h2>
        <input id="seoTitle" class="form-control mb-2" placeholder="Meta Title">
        <textarea id="seoDesc" class="form-control mb-2" placeholder="Meta Description" rows="2"></textarea>
        <input id="seoKeywords" class="form-control mb-2" placeholder="کلمات کلیدی">
        <input id="seoImage" class="form-control mb-2" placeholder="OG Image URL">
        <select id="schemaType" class="form-select mb-2">
          <option value="Article">Article</option>
          <option value="Course">Course</option>
          <option value="FAQ">FAQ</option>
        </select>
        <button class="btn btn-success" onclick="saveSeo()">ذخیره SEO</button>
      </div>
    </div>

    <!-- طراحی -->
    <div class="tab-pane fade" id="tabDesign" role="tabpanel">
      <div class="section">
        <h2>طراحی و چیدمان</h2>
        <div class="row">
          <div class="col-md-4"><label>Primary</label><input type="color" id="colorPrimary" class="form-control"></div>
          <div class="col-md-4"><label>Accent</label><input type="color" id="colorAccent" class="form-control"></div>
          <div class="col-md-4"><label>Background</label><input type="color" id="colorBg" class="form-control"></div>
        </div>
        <label>Layout Type</label>
        <select id="layoutType" class="form-select mb-2">
          <option value="responsive">Responsive</option>
          <option value="fixed">Fixed</option>
          <option value="fluid">Fluid</option>
        </select>
        <button class="btn btn-primary" onclick="saveDesign()">ذخیره طراحی</button>
      </div>
    </div>

    <!-- تیم -->
    <div class="tab-pane fade" id="tabTeam" role="tabpanel">
      <div class="section">
        <h2>همکاری تیمی</h2>
        <input id="newComment" class="form-control mb-2" placeholder="نظر یا تگ @user">
        <button class="btn btn-info" onclick="addComment()">ارسال نظر</button>
        <div id="commentsList" class="mt-2"></div>
      </div>
    </div>

    <!-- تنظیمات -->
    <div class="tab-pane fade" id="tabSettings" role="tabpanel">
      <div class="section">
        <h2>بک‌آپ / بازگردانی</h2>
        <button class="btn btn-success" onclick="exportFull()">دانلود بک‌آپ کامل</button>
        <input type="file" accept=".json" onchange="importFull(event)" class="form-control mt-2">
      </div>
      <div class="section">
        <h2>لاگ فعالیت‌ها</h2>
        <button class="btn btn-secondary" onclick="showLog()">نمایش لاگ</button>
        <pre id="logBox" style="display:none;height:200px;overflow:auto;background:#f4f4f4;padding:10px"></pre>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
<script>
/* ---------- LOGIN ---------- */
const PASSWORD='admin1234';
function login(){
  if(document.getElementById('pass').value===PASSWORD){
    localStorage.setItem('isAdmin','true');
    document.getElementById('loginBox').classList.add('d-none');
    document.getElementById('mainTabs').classList.remove('d-none');
    document.getElementById('tabContent').classList.remove('d-none');
    initQuill();
    loadAll();
  }else{
    document.getElementById('msg').textContent='رمز اشتباه است';
  }
}
function logout(){
  localStorage.removeItem('isAdmin');
  location.reload();
}
if(localStorage.getItem('isAdmin')==='true'){
  document.getElementById('loginBox').classList.add('d-none');
  document.getElementById('mainTabs').classList.remove('d-none');
  document.getElementById('tabContent').classList.remove('d-none');
  initQuill();
  loadAll();
}

/* ---------- Quill ---------- */
let quill;
function initQuill(){
  if(quill) return;
  quill=new Quill('#editorPost',{theme:'snow'});
}

/* ---------- Load All ---------- */
function loadAll(){
  loadPosts();
  loadMedia();
  loadDesign();
}

/* ---------- POST ---------- */
function generateId(){return Date.now().toString(36);}
function savePost(){
  const id=document.getElementById('postId').value || generateId();
  const post={
    id:id,
    title:document.getElementById('postTitle').value,
    type:document.getElementById('postType').value,
    content:quill.root.innerHTML,
    excerpt:document.getElementById('excerpt').value,
    publishDate:document.getElementById('publishDate').value,
    lang:document.getElementById('lang').value
  };
  const posts=JSON.parse(localStorage.getItem('posts')||'[]');
  const idx=posts.findIndex(p=>p.id===id);
  if(idx>-1) posts[idx]=post; else posts.push(post);
  localStorage.setItem('posts',JSON.stringify(posts));
  logActivity('ذخیره پست '+post.title);
  alert('ذخیره شد');
  loadPosts();
}
function loadPosts(){
  const posts=JSON.parse(localStorage.getItem('posts')||'[]');
  const list=document.getElementById('postsList'); list.innerHTML='';
  posts.forEach(p=>{
    list.innerHTML+=`
      <div class="border p-2 mb-2">
        <strong>${p.title}</strong> (${p.type})
        <button class="btn btn-sm btn-warning" onclick="editPost('${p.id}')">ویرایش</button>
        <button class="btn btn-sm btn-danger" onclick="deletePost('${p.id}')">حذف</button>
      </div>`;
  });
}
function editPost(id){
  const posts=JSON.parse(localStorage.getItem('posts')||'[]');
  const p=posts.find(x=>x.id===id);
  document.getElementById('postId').value=p.id;
  document.getElementById('postTitle').value=p.title;
  document.getElementById('postType').value=p.type;
  quill.root.innerHTML=p.content;
  document.getElementById('excerpt').value=p.excerpt;
  document.getElementById('publishDate').value=p.publishDate;
  document.getElementById('lang').value=p.lang;
}
function deletePost(id){
  if(!confirm('آیا مطمئنید؟')) return;
  const posts=JSON.parse(localStorage.getItem('posts')||'[]').filter(p=>p.id!==id);
  localStorage.setItem('posts',JSON.stringify(posts));
  loadPosts();
  logActivity('حذف پست');
}

/* ---------- Media ---------- */
function uploadMedia(e){
  [...e.target.files].forEach(file=>{
    const r=new FileReader();
    r.onload=ev=>{
      const media=JSON.parse(localStorage.getItem('media')||'[]');
      media.push({src:ev.target.result,name:file.name,size:file.size,type:file.type});
      localStorage.setItem('media',JSON.stringify(media));
      loadMedia();
    };
    r.readAsDataURL(file);
  });
}
function loadMedia(){
  const media=JSON.parse(localStorage.getItem('media')||'[]');
  const list=document.getElementById('mediaList'); list.innerHTML='';
  media.forEach((m,i)=>{
    list.innerHTML+=`<div class="col-4 col-md-2">
      <img src="${m.src}" class="img-fluid rounded">
      <button class="btn btn-sm btn-danger" onclick="deleteMedia(${i})">×</button>
    </div>`;
  });
}
function deleteMedia(i){
  const media=JSON.parse(localStorage.getItem('media')||'[]');
  media.splice(i,1);
  localStorage.setItem('media',JSON.stringify(media));
  loadMedia();
}

/* ---------- Design ---------- */
function saveDesign(){
  const design={
    primary:document.getElementById('colorPrimary').value,
    accent:document.getElementById('colorAccent').value,
    bg:document.getElementById('colorBg').value,
    layout:document.getElementById('layoutType').value
  };
  localStorage.setItem('design',JSON.stringify(design));
  logActivity('ذخیره طراحی');
  alert('طراحی ذخیره شد');
}
function loadDesign(){
  const d=JSON.parse(localStorage.getItem('design')||'{}');
  document.getElementById('colorPrimary').value=d.primary||'#00bfa5';
  document.getElementById('colorAccent').value=d.accent||'#ff6f00';
  document.getElementById('colorBg').value=d.bg||'#e0f7fa';
  document.getElementById('layoutType').value=d.layout||'responsive';
}

/* ---------- Comments ---------- */
function addComment(){
  const txt=document.getElementById('newComment').value;
  if(!txt) return;
  const c=JSON.parse(localStorage.getItem('comments')||'[]');
  c.push({text:txt,user:'Admin',time:new Date().toLocaleString('fa-IR')});
  localStorage.setItem('comments',JSON.stringify(c));
  loadComments();
}
function loadComments(){
  const c=JSON.parse(localStorage.getItem('comments')||'[]');
  const list=document.getElementById('commentsList'); list.innerHTML='';
  c.forEach((co,i)=>{
    list.innerHTML+=`<div class="border p-2 mb-2">
      ${co.text} – ${co.user} (${co.time})
      <button class="btn btn-sm btn-danger" onclick="deleteComment(${i})">×</button>
    </div>`;
  });
}
function deleteComment(i){
  const c=JSON.parse(localStorage.getItem('comments')||'[]');
  c.splice(i,1);
  localStorage.setItem('comments',JSON.stringify(c));
  loadComments();
}

/* ---------- Backup ---------- */
function exportFull(){
  const keys=['posts','media','seo','design','comments','log'];
  const data=Object.fromEntries(keys.map(k=>[k,JSON.parse(localStorage.getItem(k))||[]]));
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='full_backup.json'; a.click();
  logActivity('Export Full Backup');
}
function importFull(e){
  const file=e.target.files[0];
  if(!file) return;
  const r=new FileReader();
  r.onload=ev=>{
    const data=JSON.parse(ev.target.result);
    Object.keys(data).forEach(k=>localStorage.setItem(k,JSON.stringify(data[k])));
    loadAll();
    alert('بازگردانی شد');
    logActivity('Import Full Backup');
  };
  r.readAsText(file);
}

/* ---------- Log ---------- */
function logActivity(action){
  const log=JSON.parse(localStorage.getItem('log')||'[]');
  log.unshift({action,time:new Date().toLocaleString('fa-IR')});
  if(log.length>100) log.pop();
  localStorage.setItem('log',JSON.stringify(log));
}
</script>
</body>
</html>

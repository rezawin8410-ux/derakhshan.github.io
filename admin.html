<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<title>پنل پست‌گذاری – درخشان</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css">
<!-- Quill -->
<link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
<style>
body{font-family:Tahoma;background:#f5f5f5;margin:0}
.section{background:#fff;border-radius:12px;padding:25px;margin:25px 0;box-shadow:0 4px 12px rgba(0,0,0,.1)}
h2{color:#00bfa5;margin-bottom:15px}
#editorContainer{min-height:300px;border:1px solid #ddd;border-radius:8px}
</style>
</head>
<body>
<div class="container-fluid mt-4">
  <h1 class="text-center mb-4">پنل پست‌گذاری – درخشان</h1>
  <!-- LOGIN -->
  <div id="loginBox" class="text-center" style="max-width:400px;margin:auto">
    <input type="password" id="pass" class="form-control mb-2" placeholder="رمز عبور">
    <button class="btn btn-success w-100" onclick="login()">ورود</button>
    <p id="msg" class="text-danger mt-2"></p>
  </div>

  <!-- PANEL -->
  <div id="panel" class="d-none">
    <!-- ساخت / ویرایش پست -->
    <div class="section">
      <input type="hidden" id="postId">
      <input id="postTitle" class="form-control mb-2" placeholder="عنوان پست">
      <div id="editorContainer"></div>
      <button class="btn btn-primary mt-2" onclick="savePost()">ذخیره پست</button>
    </div>

    <!-- لیست پست‌ها -->
    <div class="section">
      <h2>پست‌های موجود</h2>
      <div id="postsList"></div>
    </div>
  </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
<script>
const PASSWORD='admin1234';
function login(){
  if(document.getElementById('pass').value===PASSWORD){
    localStorage.setItem('isAdmin','true');
    document.getElementById('loginBox').classList.add('d-none');
    document.getElementById('panel').classList.remove('d-none');
    initEditor();
    loadPosts();
  }else{
    document.getElementById('msg').textContent='رمز اشتباه است';
  }
}
function initEditor(){
  if(window.quillInstance) return;
  window.quillInstance=new Quill('#editorContainer',{theme:'snow'});
}
function generateId(){return Date.now().toString(36);}
function savePost(){
  const id=document.getElementById('postId').value || generateId();
  const post={
    id,
    title:document.getElementById('postTitle').value,
    content:quillInstance.root.innerHTML,
    created:new Date().toLocaleString('fa-IR')
  };
  const posts=JSON.parse(localStorage.getItem('posts')||'[]');
  const idx=posts.findIndex(p=>p.id===id);
  if(idx>-1) posts[idx]=post; else posts.push(post);
  localStorage.setItem('posts',JSON.stringify(posts));
  alert('پست ذخیره شد');
  document.getElementById('postId').value='';
  document.getElementById('postTitle').value='';
  quillInstance.setContents([]);
  loadPosts();
}
function loadPosts(){
  const posts=JSON.parse(localStorage.getItem('posts')||'[]');
  const list=document.getElementById('postsList'); list.innerHTML='';
  posts.forEach(p=>{
    list.innerHTML+=`
      <div class="border p-2 mb-2">
        <strong>${p.title}</strong>
        <button class="btn btn-sm btn-warning" onclick="editPost('${p.id}')">ویرایش</button>
        <button class="btn btn-sm btn-danger" onclick="deletePost('${p.id}')">حذف</button>
      </div>`;
  });
}
function editPost(id){
  const posts=JSON.parse(localStorage.getItem('posts')||'[]');
  const p=posts.find(x=>x.id===id);
  document.getElementById('postId').value=p.id;
  document.getElementById('postTitle').value=p.title;
  quillInstance.root.innerHTML=p.content;
}
function deletePost(id){
  if(!confirm('حذف شود؟')) return;
  const posts=JSON.parse(localStorage.getItem('posts')||'[]').filter(p=>p.id!==id);
  localStorage.setItem('posts',JSON.stringify(posts));
  loadPosts();
}
if(localStorage.getItem('isAdmin')==='true'){
  login();
}
</script>
</body>
</html>
